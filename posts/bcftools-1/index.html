<!DOCTYPE html><html lang="en"> <!-- The Head © 2017-2019 Cotes Chung MIT License --><head><title>bcftools usage (Updating) | 搞生信的北极熊</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ © 2019 Cotes Chung Published under the MIT license --><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" integrity="sha256-UzFD2WYH2U1dQpKDjjZK72VtPeWP50NoJjd26rnAdUI=" crossorigin="anonymous" /><link rel="stylesheet" href="/assets/css/styles.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> document.jQuery || document.write('<script src="/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous"></script> <script src="/assets/js/dist/commons.js" async></script> <!-- The GA snippet © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-146238140-1', 'auto'); ga('send', 'pageview'); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar © 2017-2019 Cotes Chung MIT License --><div id="nav-wrap"><div id="profile-wrap" class="d-flex justify-content-center"><div id="profile"> <a href="/" alt="profile-photo"> <img src="/assets/img/sample/profile.jpg"></img> </a></div></div><div id="site-title" class="d-flex justify-content-center align-items-center"> <a href="/">搞生信的北极熊</a></div><div id="site-slogan" class="font-italic">Life is not all roses <br> 人生并不是康庄大道</div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100">HOME</a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100">CATEGORIES</a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100">TAGS</a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100">ARCHIVES</a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100">ABOUT</a></li><span class="cursor"></span></ul></div><div class="contact d-flex justify-content-around mt-3"> <a href="https://github.com/flying-polarbear" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="javascript:window.open('mailto:' + ['179147112','qq.com'].join('@'))"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a></div></div><div id="main-wrap"> <!-- The Top Bar © 2017-2019 Cotes Chung MIT License --><div id="topbar" class="bg-white row justify-content-center topbar-down"><div id="topbar-main" class="d-flex h-100 align-items-center justify-content-between col-12 col-md-12 col-lg-11 col-xl-11 pl-md-2 pr-md-2 pl-lg-2 pr-lg-2"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>bcftools usage (Updating)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrap"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> </span> <a href="javascript:;">Cancel</a></div></div><div id="main"><div class="row justify-content-center bg-white"> <!-- Define the liquid date formats. © 2019 Cotes Chung Published under the MIT License --><div class="col-12 col-lg-11 col-xl-8"><div id="post-wrap" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4 pl-xl-3"><div class="post"><h1 data-toc-skip>bcftools usage (Updating)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span data-toggle="tooltip" title="Tue, Nov 26, 2019, 5:37 PM +0800"> Nov 26, 2019 </span> on <a href='/categories/tech/'>Tech</a>, <a href='/categories/bcftools/'>bcftools</a></div><div> <span id="pv" class="pageviews"><i class="fas fa-spinner fa-spin"></i></span> views</div></div><div class="post-content"><h2 id="select-genotypes-from-multi-samples">Select genotypes from multi samples</h2><p>We got a vcf file named as trio.vcf containing 3 samples for a trio family for genetic analysis:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\# ...
\# ...
\# ...
\#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  Sample1 Sample2 Sample3
1       12783   .       G       A       607.89  PASS    AC=3;AF=0.750;AN=4;BaseQRankSum=0.00;DP=27;ExcessHet=3.0103;FS=0.000;MLEAC=3;MLEAF=0.750;MQ=26.35;MQRankSum=0.621;QD=22.51;ReadPosRankSum=1.73;SOR=2.753        GT:AD:AF:DP:GQ:JL:JP:PL:PP      0/1:5,17:0.773:22:88:-1:-1:463,0,88:478,0,88    1/1:0,5:1.00:5:13:-1:-1:157,15,0:157,13,0       ./.:0,0:.:0:.:.:.:0,0,0
1       13178   .       G       A       56.48   PASS    AC=1;AF=0.167;AN=6;BaseQRankSum=1.48;DP=254;ExcessHet=3.0103;FS=9.066;MLEAC=1;MLEAF=0.167;MQ=25.58;MQRankSum=-9.600e-02;QD=2.09;ReadPosRankSum=-6.200e-02;SOR=3.287     GT:AD:AF:DP:GQ:JL:JP:PL:PP      0/0:218,0:.:218:99:3:3:0,120,1800:0,120,1803    0/1:22,5:0.185:27:64:3:3:64,0,543:64,0,603 0/0:9,0:.:9:0:3:3:0,0,194:0,0,254
...
...
</code></pre></div></div><p>The header for #… means headers of vcf, just for simplicity. And how to select all genotypes identical for all 3 samples?</p><p>Before going on next, how to select specified genotype for ONE sample? <code class="highlighter-rouge">bcftools view -i 'GT[0]~"^1.1"' trio.vcf</code>, GT[0]~”^1.1” means first sample’s GT is match pattern ‘^1.1’, which can be 1/1, 1|1.</p><p>So, we can use <code class="highlighter-rouge">bcftools view -i 'GT[0]==GT[1]' trio.vcf</code> to select subvcf that genotype of sample1 and sample2 is identical. But! Bcftools will interrupt with “Comparison between samples is not supported, sorry!” Unfortunately, we can’t do comparions between samples using bcftools.</p><h3 id="awk-for-substitution">awk for substitution</h3><p><code class="highlighter-rouge">awk '{if($0 !~ /^#/){split($(NF-2),arr1,":");split($(NF-1),arr2,":");split($NF,arr3,":");if (arr1[1]==arr2[1] &amp;&amp; arr2[1]==arr3[1]){print $0}}else if($0 ~ /^#/)print $0 }' trio.vcf</code> This awk select identical genotypes in all trio samples. Take note that keep origin headers of vcf for downstream usage with bcftools.</p></div><div class="post-tail text-muted"><div class="mb-2"> <a href="/tags/bcftools/" class="post-tag no-text-decoration" >bcftools</a></div></div></div><div class="post-pager d-flex justify-content-between"> <a href="/posts/bwa-memp/" class="btn btn-outline-primary"> <i class="fas fa-angle-left mr-2"></i>OLDER POSTS </a> <a href="/posts/fa2fq/" class="btn btn-outline-primary"> NEWER POSTS<i class="fas fa-angle-right ml-2"></i> </a></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments © 2019 Cotes Chung MIT License --><div id="disqus" class="pt-2 pb-4"><p class="font-italic text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//chirpy-demo.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://flying-polarbear.github.io//posts/bcftools-1/'; this.page.identifier = '/posts/bcftools-1/'; } }; $.disqusLoader('#disqus', options); </script></div></div><div id="post-panel" class="col-xl-3 pl-2"> <!-- The Pannel on right side (Desktop views) © 2017-2019 Cotes Chung MIT License --><div class="panel-group"><div id="panel-tags"><h3 data-toc-skip> Trending Tags</h3><div class="d-flex flex-wrap mt-2 pb-1 pr-3"><div> <a class="post-tag" href="/tags/ruby/">ruby</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/gatk/">GATK</a> <a class="post-tag" href="/tags/bioinfo/">Bioinfo</a> <a class="post-tag" href="/tags/psql/">psql</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/bwa/">bwa</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/随笔/">随笔</a></div></div></div></div><div id="toc-wrap" class="topbar-down pr-4"><h3 data-toc-skip class="pl-3 pt-2"> Contents</h3><nav id="toc" data-toggle="toc"></nav></div><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script></div><script src="/assets/js/dist/countUp.min.js" async></script> <script src="/assets/js/dist/pageviews.min.js" async></script></div><!-- The Footer © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="copyright"><p class="mb-0"> <span>© 2019-2020</span> <a class="copyright-owner" href="/tabs/about/">搞生信的变态</a>. <br>Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> & <a href="https://github.com/flying-polarbear">会飞的北极熊</a>, hosted on <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.</p></div><div class="license"><p class="mb-0"> The blog posts on this site are licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p></div></div></footer></div><!-- The Search results © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrap"><div class="row justify-content-center bg-white"><div class="col-12 col-md-12 col-lg-11 col-xl-9 pl-xl-5 pr-xl-5 pb-5 mt-3 mb-3"><h2 class="mt-3 pt-3 ml-3 ml-md-5 ml-lg-0" data-toc-skip>Search Results</h2><div class="post-content ml-1 ml-md-5 ml-lg-0"><ul id="search-results" ></ul></div></div></div></div></div><div id="mask"></div><!-- The Search © 2017-2019 Cotes Chung MIT License --> <script src="/assets/lib/simple-jekyll-search-1.7.1.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/search.json' }) </script> <a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a>
